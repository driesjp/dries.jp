<!DOCTYPE html><head><meta charset="UTF-8"><title>dries.jp - Learn Hiragana & Katakana</title><style>body{ text-align: center; font-family: Arial, sans-serif; max-width: 100%; overflow-x: hidden; padding: 10px; box-sizing: border-box; min-height: 100vh; margin: 0;} #gameArea{ display: flex; flex-direction: column; height: 100vh; max-height: 100vh; box-sizing: border-box;} canvas{ border: 1px solid black; max-width: 100%; height: 60vh; max-height: 60vh; object-fit: contain;} #choices{ margin-top: 10px; display: flex; flex-wrap: wrap; justify-content: center; gap: 10px; min-height: fit-content;} button{ font-size: clamp(16px, 4vw, 20px); padding: clamp(5px, 2vh, 10px) clamp(10px, 3vw, 20px); margin: 5px; min-width: 80px; touch-action: manipulation;} #score{ font-size: clamp(18px, 4vw, 24px); margin-top: 10px; word-wrap: break-word;} #mistakes{ margin-top: 10px; font-size: clamp(16px, 4vw, 20px); word-wrap: break-word; padding: 0 10px;} .character-sets{ margin: 10px auto; text-align: left; max-width: min(600px, 95%); padding: 10px;} .character-sets label{ display: inline-block; margin: 5px 10px; min-height: 44px;} .series-selection, .modification-types{ margin: 10px 0; padding: 10px; border: 1px solid #ccc; border-radius: 5px;} .series-selection label, .modification-types label{ display: inline-block; margin: 8px; padding: 5px; min-height: 44px;} h4{ margin: 5px 0; color: #333; font-size: clamp(16px, 4vw, 20px);} #startButton{ margin: 20px auto; padding: 15px 30px; font-size: clamp(16px, 4vw, 20px); border: 2px solid #333; border-radius: 4px; cursor: pointer; transition: all 0.3s ease; display: block; width: min(200px, 90%);} #startButton:hover{ transform: scale(1.05);} #toggleOptions{ margin: 10px auto; padding: 5px 15px; font-size: clamp(14px, 3.5vw, 16px); background-color: #f0f0f0; border: 1px solid #ccc; border-radius: 4px; cursor: pointer; display: block; width: min(150px, 80%);} #toggleOptions:hover{ background-color: #e0e0e0;} #optionsContainer.collapsed{ display: none;} #speedControl{ margin: 15px auto; width: min(200px, 90%);} #speedSlider{ width: 100%; cursor: pointer; height: 25px; margin: 10px 0;} input[type="checkbox"]{ width: 20px; height: 20px; margin-right: 8px; vertical-align: middle;} #logo{ position: absolute; top: 10px; left: 10px; z-index: 1000; text-decoration: none;} #logo img{ max-width: 100px; height: auto; display: block;} @media (max-width: 480px){ .character-sets label{ margin: 3px 5px;} button{ margin: 5px; padding: 8px 15px;} #stopButton{ width: min(150px, 80%); margin: 15px auto;} canvas{ height: 50vh;}} </style></head><body><a href="https://dries.jp" id="logo"><img src="https://dries.jp/img/duck.png" target="_new" alt="dries.jp" /></a><h1>Practice Hiragana & Katakana</h1><div id="optionsContainer"><div id="modeButtons"><div class="practice-mode" style="margin: 20px 0;"><h4>Practice Mode:</h4><label style="margin-right: 20px;"><input type="radio" name="practiceMode" value="guessRomaji" checked>Romaji </label><label><input type="radio" name="practiceMode" value="guessKana">Kana </label></div><button onclick="selectMode('hiragana')">Start Hiragana Game</button><button onclick="selectMode('katakana')">Start Katakana Game</button></div><button id="startButton" style="display: none;" onclick="startGame()">Start Practice</button><div class="character-sets"><div id="hiraganaOptions" style="display: none;"><h3>Select character sets to practice:</h3><div class="series-selection"><h4>Character Series:</h4><label><input type="checkbox" value="vowels">Vowels (あいうえお)</label><label><input type="checkbox" value="k">K-Series (かきくけこ)</label><label><input type="checkbox" value="s">S-Series (さしすせそ)</label><label><input type="checkbox" value="t">T-Series (たちつてと)</label><label><input type="checkbox" value="n">N-Series (なにぬねの)</label><label><input type="checkbox" value="h">H-Series (はひふへほ)</label><label><input type="checkbox" value="m">M-Series (まみむめも)</label><label><input type="checkbox" value="y">Y-Series (やゆよ)</label><label><input type="checkbox" value="r">R-Series (らりるれろ)</label><label><input type="checkbox" value="w">W-Series (わをん)</label></div><div class="modification-types"><h4>Modifications:</h4><label><input type="checkbox" value="dakuten">Dakuten (が-ぼ)</label><label><input type="checkbox" value="handakuten">Handakuten (ぱ-ぽ)</label><label><input type="checkbox" value="combinations">Combinations (きゃ-ぴょ)</label></div></div><div id="katakanaOptions" style="display: none;"><h3>Select character sets to practice:</h3><div class="series-selection"><h4>Character Series:</h4><label><input type="checkbox" value="vowels">Vowels (アイウエオ)</label><label><input type="checkbox" value="k">K-Series (カキクケコ)</label><label><input type="checkbox" value="s">S-Series (サシスセソ)</label><label><input type="checkbox" value="t">T-Series (タチツテト)</label><label><input type="checkbox" value="n">N-Series (ナニヌネノ)</label><label><input type="checkbox" value="h">H-Series (ハヒフヘホ)</label><label><input type="checkbox" value="m">M-Series (マミムメモ)</label><label><input type="checkbox" value="y">Y-Series (ヤユヨ)</label><label><input type="checkbox" value="r">R-Series (ラリルレロ)</label><label><input type="checkbox" value="w">W-Series (ワヲン)</label></div><div class="modification-types"><h4>Modifications:</h4><label><input type="checkbox" value="dakuten">Dakuten (ガ-ボ)</label><label><input type="checkbox" value="handakuten">Handakuten (パ-ポ)</label><label><input type="checkbox" value="combinations">Combinations (キャ-ピョ)</label></div></div></div><div id="speedControl" style="margin: 10px auto; width: 200px; display: none;"><label for="speedSlider">Speed: <span id="speedValue">1</span>x</label><input type="range" id="speedSlider" min="0.5" max="3" step="0.5" value="1.0"></div></div><button id="toggleOptions" style="display: none;" onclick="toggleOptionsView()">Show Options ▼</button><div id="gameArea" style="display: none;"><canvas id="gameCanvas" width="400" height="600"></canvas><div id="choices"></div><div id="score">Score: 0</div><div id="mistakes">Mistakes:</div><button id="stopButton" onclick="stopGame()" style="margin-top: 20px; background-color: #ff4444; color: white; border: none; padding: 10px 20px; border-radius: 4px; cursor: pointer;">Stop Game</button></div><script>const hiragana=[ { char: 'あ', romaji: 'a'},{ char: 'い', romaji: 'i'},{ char: 'う', romaji: 'u'},{ char: 'え', romaji: 'e'},{ char: 'お', romaji: 'o'}, { char: 'か', romaji: 'ka'},{ char: 'き', romaji: 'ki'},{ char: 'く', romaji: 'ku'},{ char: 'け', romaji: 'ke'},{ char: 'こ', romaji: 'ko'}, { char: 'さ', romaji: 'sa'},{ char: 'し', romaji: 'shi'},{ char: 'す', romaji: 'su'},{ char: 'せ', romaji: 'se'},{ char: 'そ', romaji: 'so'}, { char: 'た', romaji: 'ta'},{ char: 'ち', romaji: 'chi'},{ char: 'つ', romaji: 'tsu'},{ char: 'て', romaji: 'te'},{ char: 'と', romaji: 'to'}, { char: 'な', romaji: 'na'},{ char: 'に', romaji: 'ni'},{ char: 'ぬ', romaji: 'nu'},{ char: 'ね', romaji: 'ne'},{ char: 'の', romaji: 'no'}, { char: 'は', romaji: 'ha'},{ char: 'ひ', romaji: 'hi'},{ char: 'ふ', romaji: 'fu'},{ char: 'へ', romaji: 'he'},{ char: 'ほ', romaji: 'ho'}, { char: 'ま', romaji: 'ma'},{ char: 'み', romaji: 'mi'},{ char: 'む', romaji: 'mu'},{ char: 'め', romaji: 'me'},{ char: 'も', romaji: 'mo'}, { char: 'や', romaji: 'ya'},{ char: 'ゆ', romaji: 'yu'},{ char: 'よ', romaji: 'yo'}, { char: 'ら', romaji: 'ra'},{ char: 'り', romaji: 'ri'},{ char: 'る', romaji: 'ru'},{ char: 'れ', romaji: 're'},{ char: 'ろ', romaji: 'ro'}, { char: 'わ', romaji: 'wa'},{ char: 'を', romaji: 'wo'},{ char: 'ん', romaji: 'n'}, { char: 'が', romaji: 'ga'},{ char: 'ぎ', romaji: 'gi'},{ char: 'ぐ', romaji: 'gu'},{ char: 'げ', romaji: 'ge'},{ char: 'ご', romaji: 'go'}, { char: 'ざ', romaji: 'za'},{ char: 'じ', romaji: 'ji'},{ char: 'ず', romaji: 'zu'},{ char: 'ぜ', romaji: 'ze'},{ char: 'ぞ', romaji: 'zo'}, { char: 'だ', romaji: 'da'},{ char: 'ぢ', romaji: 'ji'},{ char: 'づ', romaji: 'zu'},{ char: 'で', romaji: 'de'},{ char: 'ど', romaji: 'do'}, { char: 'ば', romaji: 'ba'},{ char: 'び', romaji: 'bi'},{ char: 'ぶ', romaji: 'bu'},{ char: 'べ', romaji: 'be'},{ char: 'ぼ', romaji: 'bo'}, { char: 'ぱ', romaji: 'pa'},{ char: 'ぴ', romaji: 'pi'},{ char: 'ぷ', romaji: 'pu'},{ char: 'ぺ', romaji: 'pe'},{ char: 'ぽ', romaji: 'po'}, { char: 'きゃ', romaji: 'kya'},{ char: 'きゅ', romaji: 'kyu'},{ char: 'きょ', romaji: 'kyo'}, { char: 'しゃ', romaji: 'sha'},{ char: 'しゅ', romaji: 'shu'},{ char: 'しょ', romaji: 'sho'}, { char: 'ちゃ', romaji: 'cha'},{ char: 'ちゅ', romaji: 'chu'},{ char: 'ちょ', romaji: 'cho'}, { char: 'にゃ', romaji: 'nya'},{ char: 'にゅ', romaji: 'nyu'},{ char: 'にょ', romaji: 'nyo'}, { char: 'ひゃ', romaji: 'hya'},{ char: 'ひゅ', romaji: 'hyu'},{ char: 'ひょ', romaji: 'hyo'}, { char: 'みゃ', romaji: 'mya'},{ char: 'みゅ', romaji: 'myu'},{ char: 'みょ', romaji: 'myo'}, { char: 'りゃ', romaji: 'rya'},{ char: 'りゅ', romaji: 'ryu'},{ char: 'りょ', romaji: 'ryo'}, { char: 'ぎゃ', romaji: 'gya'},{ char: 'ぎゅ', romaji: 'gyu'},{ char: 'ぎょ', romaji: 'gyo'}, { char: 'じゃ', romaji: 'ja'},{ char: 'じゅ', romaji: 'ju'},{ char: 'じょ', romaji: 'jo'}, { char: 'びゃ', romaji: 'bya'},{ char: 'びゅ', romaji: 'byu'},{ char: 'びょ', romaji: 'byo'}, { char: 'ぴゃ', romaji: 'pya'},{ char: 'ぴゅ', romaji: 'pyu'},{ char: 'ぴょ', romaji: 'pyo'}
]; const katakana=[ { char: 'ア', romaji: 'a'},{ char: 'イ', romaji: 'i'},{ char: 'ウ', romaji: 'u'},{ char: 'エ', romaji: 'e'},{ char: 'オ', romaji: 'o'}, { char: 'カ', romaji: 'ka'},{ char: 'キ', romaji: 'ki'},{ char: 'ク', romaji: 'ku'},{ char: 'ケ', romaji: 'ke'},{ char: 'コ', romaji: 'ko'}, { char: 'サ', romaji: 'sa'},{ char: 'シ', romaji: 'shi'},{ char: 'ス', romaji: 'su'},{ char: 'セ', romaji: 'se'},{ char: 'ソ', romaji: 'so'}, { char: 'タ', romaji: 'ta'},{ char: 'チ', romaji: 'chi'},{ char: 'ツ', romaji: 'tsu'},{ char: 'テ', romaji: 'te'},{ char: 'ト', romaji: 'to'}, { char: 'ナ', romaji: 'na'},{ char: 'ニ', romaji: 'ni'},{ char: 'ヌ', romaji: 'nu'},{ char: 'ネ', romaji: 'ne'},{ char: 'ノ', romaji: 'no'},
{ char: 'ハ', romaji: 'ha'},{ char: 'ヒ', romaji: 'hi'},{ char: 'フ', romaji: 'fu'},{ char: 'ヘ', romaji: 'he'},{ char: 'ホ', romaji: 'ho'}, { char: 'マ', romaji: 'ma'},{ char: 'ミ', romaji: 'mi'},{ char: 'ム', romaji: 'mu'},{ char: 'メ', romaji: 'me'},{ char: 'モ', romaji: 'mo'}, { char: 'ヤ', romaji: 'ya'},{ char: 'ユ', romaji: 'yu'},{ char: 'ヨ', romaji: 'yo'}, { char: 'ラ', romaji: 'ra'},{ char: 'リ', romaji: 'ri'},{ char: 'ル', romaji: 'ru'},{ char: 'レ', romaji: 're'},{ char: 'ロ', romaji: 'ro'}, { char: 'ワ', romaji: 'wa'},{ char: 'ヲ', romaji: 'wo'},{ char: 'ン', romaji: 'n'}, { char: 'ガ', romaji: 'ga'},{ char: 'ギ', romaji: 'gi'},{ char: 'グ', romaji: 'gu'},{ char: 'ゲ', romaji: 'ge'},{ char: 'ゴ', romaji: 'go'}, { char: 'ザ', romaji: 'za'},{ char: 'ジ', romaji: 'ji'},{ char: 'ズ', romaji: 'zu'},{ char: 'ゼ', romaji: 'ze'},{ char: 'ゾ', romaji: 'zo'}, { char: 'ダ', romaji: 'da'},{ char: 'ヂ', romaji: 'ji'},{ char: 'ヅ', romaji: 'zu'},{ char: 'デ', romaji: 'de'},{ char: 'ド', romaji: 'do'}, { char: 'バ', romaji: 'ba'},{ char: 'ビ', romaji: 'bi'},{ char: 'ブ', romaji: 'bu'},{ char: 'ベ', romaji: 'be'},{ char: 'ボ', romaji: 'bo'}, { char: 'パ', romaji: 'pa'},{ char: 'ピ', romaji: 'pi'},{ char: 'プ', romaji: 'pu'},{ char: 'ペ', romaji: 'pe'},{ char: 'ポ', romaji: 'po'}, { char: 'キャ', romaji: 'kya'},{ char: 'キュ', romaji: 'kyu'},{ char: 'キョ', romaji: 'kyo'}, { char: 'シャ', romaji: 'sha'},{ char: 'シュ', romaji: 'shu'},{ char: 'ショ', romaji: 'sho'}, { char: 'チャ', romaji: 'cha'},{ char: 'チュ', romaji: 'chu'},{ char: 'チョ', romaji: 'cho'}, { char: 'ニャ', romaji: 'nya'},{ char: 'ニュ', romaji: 'nyu'},{ char: 'ニョ', romaji: 'nyo'}, { char: 'ヒャ', romaji: 'hya'},{ char: 'ヒュ', romaji: 'hyu'},{ char: 'ヒョ', romaji: 'hyo'}, { char: 'ミャ', romaji: 'mya'},{ char: 'ミュ', romaji: 'myu'},{ char: 'ミョ', romaji: 'myo'}, { char: 'リャ', romaji: 'rya'},{ char: 'リュ', romaji: 'ryu'},{ char: 'リョ', romaji: 'ryo'}, { char: 'ギャ', romaji: 'gya'},{ char: 'ギュ', romaji: 'gyu'},{ char: 'ギョ', romaji: 'gyo'}, { char: 'ジャ', romaji: 'ja'},{ char: 'ジュ', romaji: 'ju'},{ char: 'ジョ', romaji: 'jo'}, { char: 'ビャ', romaji: 'bya'},{ char: 'ビュ', romaji: 'byu'},{ char: 'ビョ', romaji: 'byo'}, { char: 'ピャ', romaji: 'pya'},{ char: 'ピュ', romaji: 'pyu'},{ char: 'ピョ', romaji: 'pyo'} ]; let currentChar, gameMode, gameChars, score=0, mistakes=[]; let canvas=document.getElementById('gameCanvas'); let ctx=canvas.getContext('2d'); let charY=0; let charSpeed=1; let animationId=null; let isGameActive=false;
let baseSpeed=1;
let speedMultiplier=1;
let practiceMode='guessRomaji'; document.addEventListener('DOMContentLoaded', function(){ updateSpeed(); practiceMode=document.querySelector('input[name="practiceMode"]:checked').value; document.querySelectorAll('input[name="practiceMode"]').forEach(radio=>{ radio.addEventListener('change', function(){ practiceMode=this.value;});});}); document.addEventListener('DOMContentLoaded', function(){ updateSpeed();});
document.querySelectorAll('input[name="practiceMode"]').forEach(radio=>{ radio.addEventListener('change', function(){ practiceMode=this.value;});}); function selectMode(mode){ gameMode=mode; document.getElementById('hiraganaOptions').style.display=mode==='hiragana' ? 'block' : 'none'; document.getElementById('katakanaOptions').style.display=mode==='katakana' ? 'block' : 'none'; document.getElementById('startButton').style.display='block'; document.getElementById('speedControl').style.display='block';} function updateSpeed(){ speedMultiplier=parseFloat(document.getElementById('speedSlider').value); document.getElementById('speedValue').textContent=speedMultiplier; charSpeed=baseSpeed * speedMultiplier;} function getCharacterSeries(char){ const series={ vowels: 'あいうえおアイウエオ', k: 'かきくけこカキクケコ', s: 'さしすせそサシスセソ', t: 'たちつてとタチツテト', n: 'なにぬねのナニヌネノ', h: 'はひふへほハヒフヘホ', m: 'まみむめもマミムメモ', y: 'やゆよヤユヨ', r: 'らりるれろラリルレロ', w: 'わをんワヲン'}; for (const [seriesName, chars] of Object.entries(series)){ if (chars.includes(char)){ return{ series: seriesName};}} return{ series: null};} function getBaseCharacter(char){ const modifiedToBase={ 'が': 'か', 'ぎ': 'き', 'ぐ': 'く', 'げ': 'け', 'ご': 'こ', 'ざ': 'さ', 'じ': 'し', 'ず': 'す', 'ぜ': 'せ', 'ぞ': 'そ', 'だ': 'た', 'ぢ': 'ち', 'づ': 'つ', 'で': 'て', 'ど': 'と', 'ば': 'は', 'び': 'ひ', 'ぶ': 'ふ', 'べ': 'へ', 'ぼ': 'ほ', 'ぱ': 'は', 'ぴ': 'ひ', 'ぷ': 'ふ', 'ぺ': 'へ', 'ぽ': 'ほ', 'ガ': 'カ', 'ギ': 'キ', 'グ': 'ク', 'ゲ': 'ケ', 'ゴ': 'コ', 'ザ': 'サ', 'ジ': 'シ', 'ズ': 'ス', 'ゼ': 'セ', 'ゾ': 'ソ', 'ダ': 'タ', 'ヂ': 'チ', 'ヅ': 'ツ', 'デ': 'テ', 'ド': 'ト', 'バ': 'ハ', 'ビ': 'ヒ', 'ブ': 'フ', 'ベ': 'ヘ', 'ボ': 'ホ', 'パ': 'ハ', 'ピ': 'ヒ', 'プ': 'フ', 'ペ': 'ヘ', 'ポ': 'ホ'}; return modifiedToBase[char] || char;} function getSelectedCharacters(){ const optionsDiv=document.getElementById(gameMode + 'Options'); const selectedSeries=Array.from(optionsDiv.querySelector('.series-selection').querySelectorAll('input:checked')).map(cb=>cb.value); const selectedMods=Array.from(optionsDiv.querySelector('.modification-types').querySelectorAll('input:checked')).map(cb=>cb.value); let selectedChars=[]; const allChars=gameMode==='hiragana' ? hiragana : katakana; allChars.forEach(char=>{ const isBasicChar=char.char.length===1 && !char.char.match(/[がぎぐげござじずぜぞだぢづでどばびぶべぼぱぴぷぺぽガギグゲゴザジズゼゾダヂヅデドバビブベボパピプペポ]/); if (isBasicChar){ const charInfo=getCharacterSeries(char.char); if (selectedSeries.includes(charInfo.series)){ selectedChars.push(char);}} if (selectedMods.includes('dakuten') && char.char.length===1 && char.char.match(/[がぎぐげござじずぜぞだぢづでどばびぶべぼガギグゲゴザジズゼゾダヂヅデドバビブベボ]/)){ const baseChar=getBaseCharacter(char.char); const charInfo=getCharacterSeries(baseChar); if (selectedSeries.includes(charInfo.series)){ selectedChars.push(char);}} if (selectedMods.includes('handakuten') && char.char.length===1 && char.char.match(/[ぱぴぷぺぽパピプペポ]/)){ const baseChar=getBaseCharacter(char.char); const charInfo=getCharacterSeries(baseChar); if (selectedSeries.includes(charInfo.series)){ selectedChars.push(char);}} if (selectedMods.includes('combinations') && char.char.length >1){ const baseChar=char.char[0]; const charInfo=getCharacterSeries(baseChar); if (selectedSeries.includes(charInfo.series)){ selectedChars.push(char);}}}); return selectedChars;} function toggleOptionsView(){ const optionsContainer=document.getElementById('optionsContainer'); const toggleButton=document.getElementById('toggleOptions'); if (optionsContainer.classList.contains('collapsed')){ optionsContainer.classList.remove('collapsed'); toggleButton.textContent='Hide Options ▲';} else{ optionsContainer.classList.add('collapsed'); toggleButton.textContent='Show Options ▼';}} function startGame(){ isGameActive=true; gameChars=getSelectedCharacters(); if (gameChars.length===0){ alert('Please select at least one character set!'); return;} score=0; mistakes=[]; document.getElementById('score').textContent="Score: 0"; document.getElementById('mistakes').innerHTML="Mistakes: "; charY=0; if (animationId){ cancelAnimationFrame(animationId);} document.getElementById('optionsContainer').classList.add('collapsed'); document.getElementById('toggleOptions').style.display='block'; document.getElementById('toggleOptions').textContent='Show Options ▼'; document.getElementById('gameArea').style.display='block'; nextChar(); update();} function nextChar(){ if (!isGameActive) return; if (gameChars.length===0 && mistakes.length===0){ isGameActive=false; cancelAnimationFrame(animationId); alert('Well done! Final Score: ' + score); ctx.clearRect(0, 0, canvas.width, canvas.height); document.getElementById('optionsContainer').classList.remove('collapsed'); document.getElementById('toggleOptions').style.display='none'; document.getElementById('gameArea').style.display='none'; return;} if (gameChars.length===0){ gameChars=[...mistakes]; mistakes=[];} let randomIndex=Math.floor(Math.random() * gameChars.length); currentChar=gameChars[randomIndex]; gameChars.splice(randomIndex, 1); const choices=generateChoices(currentChar); renderChoices(choices);} function checkAnswer(selected){ if (!isGameActive) return; const correct=practiceMode==='guessRomaji' ? selected===currentChar.romaji : selected===currentChar.char; if (correct){ score++; document.getElementById('score').textContent="Score: " + score;} else{ if (!mistakes.find(m=>m.char===currentChar.char)){ mistakes.push(currentChar);} updateMistakes(); flashBackground();} charY=0; nextChar();} function update(){ if (!isGameActive) return; ctx.clearRect(0, 0, canvas.width, canvas.height); ctx.font=practiceMode==='guessRomaji' ? "48px Arial" : "36px Arial"; const displayText=practiceMode==='guessRomaji' ? currentChar.char : currentChar.romaji; const textWidth=ctx.measureText(displayText).width; ctx.fillText(displayText, canvas.width / 2 - textWidth/2, charY); charY +=charSpeed; if (charY >canvas.height){ charY=0; if (!mistakes.find(m=>m.char===currentChar.char)){ mistakes.push(currentChar);} updateMistakes(); nextChar();} animationId=requestAnimationFrame(update);} function stopGame(){ if (!isGameActive) return; isGameActive=false; cancelAnimationFrame(animationId); ctx.clearRect(0, 0, canvas.width, canvas.height); document.getElementById('optionsContainer').classList.remove('collapsed'); document.getElementById('toggleOptions').style.display='none'; document.getElementById('gameArea').style.display='none';} function generateChoices(currentChar){ let choices=[]; const optionsDiv=document.getElementById(gameMode + 'Options'); const selectedSeries=Array.from(optionsDiv.querySelector('.series-selection').querySelectorAll('input:checked')).map(cb=>cb.value); const selectedMods=Array.from(optionsDiv.querySelector('.modification-types').querySelectorAll('input:checked')).map(cb=>cb.value); let possibleChoices=(gameMode==='hiragana' ? hiragana : katakana) .filter(char=>{ const baseChar=getBaseCharacter(char.char); const charInfo=getCharacterSeries(baseChar); const isBasicChar=char.char.length===1 && !char.char.match(/[がぎぐげござじずぜぞだぢづでどばびぶべぼぱぴぷぺぽガギグゲゴザジズゼゾダヂヅデドバビブベボパピプペポ]/); const isDakuten=char.char.length===1 && char.char.match(/[がぎぐげござじずぜぞだぢづでどばびぶべぼガギグゲゴザジズゼゾダヂヅデドバビブベボ]/); const isHandakuten=char.char.length===1 && char.char.match(/[ぱぴぷぺぽパピプペポ]/); const isCombination=char.char.length >1; return (isBasicChar && selectedSeries.includes(charInfo.series)) || (isDakuten && selectedMods.includes('dakuten') && selectedSeries.includes(charInfo.series)) || (isHandakuten && selectedMods.includes('handakuten') && selectedSeries.includes(charInfo.series)) || (isCombination && selectedMods.includes('combinations') && selectedSeries.includes(charInfo.series));}); if (practiceMode==='guessRomaji'){ choices.push(currentChar.romaji); possibleChoices=possibleChoices .map(c=>c.romaji) .filter(r=>r !==currentChar.romaji); for (let i=0; i < 2 && possibleChoices.length >0; i++){ const idx=Math.floor(Math.random() * possibleChoices.length); choices.push(possibleChoices[idx]); possibleChoices.splice(idx, 1);}} else{ choices.push(currentChar.char); possibleChoices=possibleChoices .map(c=>c.char) .filter(c=>c !==currentChar.char); for (let i=0; i < 2 && possibleChoices.length >0; i++){ const idx=Math.floor(Math.random() * possibleChoices.length); choices.push(possibleChoices[idx]); possibleChoices.splice(idx, 1);}} return shuffle(choices);} function shuffle(array){ for (let i=array.length - 1; i >0; i--){ const j=Math.floor(Math.random() * (i + 1)); [array[i], array[j]]=[array[j], array[i]];} return array;} function renderChoices(choices){ let choicesDiv=document.getElementById('choices'); choicesDiv.innerHTML=''; choices.forEach((choice, index)=>{ if (!choice){ return;} let btn=document.createElement('button'); btn.textContent=choice; btn.onclick=()=>checkAnswer(choice); btn.id=`choice${index + 1}`; if (practiceMode==='guessKana'){ btn.style.fontSize='28px';} choicesDiv.appendChild(btn);});} function checkAnswerByKey(key){ let choiceButton=document.getElementById(`choice${key}`); if (choiceButton){ checkAnswer(choiceButton.textContent);}} function updateMistakes(){ let mistakesDiv=document.getElementById('mistakes'); let mistakesHtml=mistakes.map(mistake=>`${mistake.char} (${mistake.romaji})`).join(', '); mistakesDiv.innerHTML="Mistakes: " + mistakesHtml;} function flashBackground(){ canvas.style.backgroundColor='#ffeae6'; setTimeout(()=>{ canvas.style.backgroundColor='white';}, 100);} document.getElementById('speedSlider').addEventListener('input', updateSpeed); document.addEventListener('keydown', function(event){ if (event.key >='1' && event.key <='3'){ checkAnswerByKey(event.key);}}); </script></body></html>
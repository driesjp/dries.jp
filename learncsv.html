<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>dries.jp - Learn CSV</title><style>body{ text-align: center; font-family: Arial, sans-serif; max-width: 100%; overflow-x: hidden; padding: 10px; box-sizing: border-box; min-height: 100vh; margin: 0;} #gameArea{ display: flex; flex-direction: column; height: 100vh; max-height: 100vh; box-sizing: border-box;} canvas{ border: 1px solid black; max-width: 100%; height: 60vh; max-height: 60vh; object-fit: contain;} #choices{ margin-top: 10px; display: flex; flex-wrap: wrap; justify-content: center; gap: 10px; min-height: fit-content;} button{ font-size: clamp(16px, 4vw, 20px); padding: clamp(5px, 2vh, 10px) clamp(10px, 3vw, 20px); margin: 5px; min-width: 80px; touch-action: manipulation;} #score{ font-size: clamp(18px, 4vw, 24px); margin-top: 10px; word-wrap: break-word;} #mistakes{ margin-top: 10px; font-size: clamp(16px, 4vw, 20px); word-wrap: break-word; padding: 0 10px;} .character-sets{ margin: 10px auto; text-align: left; max-width: min(600px, 95%); padding: 10px;} .character-sets label{ display: inline-block; margin: 5px 10px; min-height: 44px;} .series-selection, .modification-types{ margin: 10px 0; padding: 10px; border: 1px solid #ccc; border-radius: 5px;} .series-selection label, .modification-types label{ display: inline-block; margin: 8px; padding: 5px; min-height: 44px;} h4{ margin: 5px 0; color: #333; font-size: clamp(16px, 4vw, 20px);} #startButton{ margin: 20px auto; padding: 15px 30px; font-size: clamp(16px, 4vw, 20px); border: 2px solid #333; border-radius: 4px; cursor: pointer; transition: all 0.3s ease; display: block; width: min(200px, 90%);} #startButton:hover{ transform: scale(1.05);} #toggleOptions{ margin: 10px auto; padding: 5px 15px; font-size: clamp(14px, 3.5vw, 16px); background-color: #f0f0f0; border: 1px solid #ccc; border-radius: 4px; cursor: pointer; display: block; width: min(150px, 80%);} #toggleOptions:hover{ background-color: #e0e0e0;} #optionsContainer.collapsed{ display: none;} #speedControl{ margin: 15px auto; width: min(200px, 90%);} #speedSlider{ width: 100%; cursor: pointer; height: 25px; margin: 10px 0;} input[type="checkbox"]{ width: 20px; height: 20px; margin-right: 8px; vertical-align: middle;} #logo{ position: absolute; top: 10px; left: 10px; z-index: 1000; text-decoration: none;} #logo img{ max-width: 100px; height: auto; display: block;} @media (max-width: 480px){ .character-sets label{ margin: 3px 5px;} button{ margin: 5px; padding: 8px 15px;} #stopButton{ width: min(150px, 80%); margin: 15px auto;} canvas{ height: 50vh;}} </style></head><body><a href="https://dries.jp" id="logo"><img src="https://dries.jp/img/duck.png" target="_new" alt="dries.jp" /></a><h1>Learn CSV</h1><div id="optionsContainer"><div id="fileInput"><p class="hint">Upload a CSV file with format: item,answer (one pair per line) (<a href="example.csv">download example</a>)</p><input type="file" id="contentFile" accept=".csv,.txt"><div id="preview"></div></div><div id="speedControl" style="margin: 10px auto; width: 200px;"><label for="speedSlider">Speed: <span id="speedValue">1</span>x</label><input type="range" id="speedSlider" min="0.5" max="3" step="0.5" value="1.0"></div><button id="startButton" onclick="startGame()" style="display: none;">Start Practice</button></div><div id="speedControl" style="margin: 10px auto; width: 200px; display: none;"><label for="speedSlider">Speed: <span id="speedValue">1</span>x</label><input type="range" id="speedSlider" min="0.5" max="3" step="0.5" value="1.0"></div></div><button id="toggleOptions" style="display: none;" onclick="toggleOptionsView()">Show Options ▼</button><div id="gameArea" style="display: none;"><canvas id="gameCanvas" width="400" height="600"></canvas><div id="choices"></div><div id="score">Score: 0</div><div id="mistakes">Mistakes:</div><button id="stopButton" onclick="stopGame()" style="margin-top: 20px; background-color: #ff4444; color: white; border: none; padding: 10px 20px; border-radius: 4px; cursor: pointer;">Stop Game</button></div><script>let currentChar, gameChars, score=0, mistakes=[];
let canvas=document.getElementById('gameCanvas');
let ctx=canvas.getContext('2d');
let charY=0;
let charSpeed=1;
let animationId=null;
let isGameActive=false;
let baseSpeed=1;
let speedMultiplier=1;
let contentPairs=[]; document.addEventListener('DOMContentLoaded', function(){ updateSpeed(); setupFileInput(); const storedContent=localStorage.getItem('contentPairs'); if (storedContent){ contentPairs=JSON.parse(storedContent); document.getElementById('preview').innerHTML=`Loaded ${contentPairs.length} pairs`; document.getElementById('startButton').style.display='block';}}); function setupFileInput(){ document.getElementById('contentFile').addEventListener('change', function(e){ const file=e.target.files[0]; const reader=new FileReader(); reader.onload=function(e){ processContent(e.target.result);}; reader.readAsText(file);});} function processContent(text){ contentPairs=text.split('\n') .map(line=>line.trim()) .filter(line=>line && line.includes(',')) .map(line=>{ const [item, answer]=line.split(',').map(s=>s.trim()); return{char: item, romaji: answer};}); if(contentPairs.length >0){ localStorage.setItem('contentPairs', JSON.stringify(contentPairs)); document.getElementById('preview').innerHTML=`Loaded ${contentPairs.length} pairs`; document.getElementById('startButton').style.display='block';}} function updateSpeed(){ speedMultiplier=parseFloat(document.getElementById('speedSlider').value); document.getElementById('speedValue').textContent=speedMultiplier; charSpeed=baseSpeed * speedMultiplier;} function startGame(){ if(contentPairs.length===0){ alert('Please upload content first!'); return;} isGameActive=true; gameChars=[...contentPairs]; score=0; mistakes=[]; document.getElementById('score').textContent="Score: 0"; document.getElementById('mistakes').innerHTML="Mistakes: "; charY=0; if (animationId){ cancelAnimationFrame(animationId);} document.getElementById('optionsContainer').classList.add('collapsed'); document.getElementById('toggleOptions').style.display='block'; document.getElementById('toggleOptions').textContent='Show Options ▼'; document.getElementById('gameArea').style.display='block'; nextChar(); update();} function generateChoices(currentPair){ let choices=[currentPair.romaji]; let possibleChoices=contentPairs .filter(pair=>pair !==currentPair) .map(pair=>pair.romaji); for(let i=0; i < 2 && possibleChoices.length >0; i++){ const idx=Math.floor(Math.random() * possibleChoices.length); choices.push(possibleChoices[idx]); possibleChoices.splice(idx, 1);} return shuffle(choices);} function shuffle(array){ for (let i=array.length - 1; i >0; i--){ const j=Math.floor(Math.random() * (i + 1)); [array[i], array[j]]=[array[j], array[i]];} return array;} function update(){ if (!isGameActive) return; ctx.clearRect(0, 0, canvas.width, canvas.height); ctx.font="36px Arial"; const displayText=currentChar.char; const textWidth=ctx.measureText(displayText).width; ctx.fillText(displayText, canvas.width/2 - textWidth/2, charY); charY +=charSpeed; if (charY >canvas.height){ charY=0; if (!mistakes.find(m=>m.char===currentChar.char)){ mistakes.push(currentChar);} updateMistakes(); nextChar();} animationId=requestAnimationFrame(update);} function checkAnswerByKey(key){ let choiceButton=document.getElementById(`choice${key}`); if (choiceButton){ checkAnswer(choiceButton.textContent);}} function nextChar(){ if (!isGameActive) return; if (gameChars.length===0 && mistakes.length===0){ isGameActive=false; cancelAnimationFrame(animationId); alert('Well done! Final Score: ' + score); ctx.clearRect(0, 0, canvas.width, canvas.height); document.getElementById('optionsContainer').classList.remove('collapsed'); document.getElementById('toggleOptions').style.display='none'; document.getElementById('gameArea').style.display='none'; return;} if (gameChars.length===0){ gameChars=[...mistakes]; mistakes=[];} let randomIndex=Math.floor(Math.random() * gameChars.length); currentChar=gameChars[randomIndex]; gameChars.splice(randomIndex, 1); const choices=generateChoices(currentChar); renderChoices(choices);} function renderChoices(choices){ let choicesDiv=document.getElementById('choices'); choicesDiv.innerHTML=''; choices.forEach((choice, index)=>{ if (!choice) return; let btn=document.createElement('button'); btn.textContent=choice; btn.onclick=()=>checkAnswer(choice); btn.id=`choice${index + 1}`; choicesDiv.appendChild(btn);});} function checkAnswer(selected){ if (!isGameActive) return; if (selected===currentChar.romaji){ score++; document.getElementById('score').textContent="Score: " + score;} else{ if (!mistakes.find(m=>m.char===currentChar.char)){ mistakes.push(currentChar);} updateMistakes(); flashBackground();} charY=0; nextChar();} function updateMistakes(){ let mistakesDiv=document.getElementById('mistakes'); let mistakesHtml=mistakes.map(mistake=>`${mistake.char} (${mistake.romaji})`).join(', '); mistakesDiv.innerHTML="Mistakes: " + mistakesHtml;} function flashBackground(){ canvas.style.backgroundColor='#ffeae6'; setTimeout(()=>{ canvas.style.backgroundColor='white';}, 100);} function toggleOptionsView(){ const optionsContainer=document.getElementById('optionsContainer'); const toggleButton=document.getElementById('toggleOptions'); if (optionsContainer.classList.contains('collapsed')){ optionsContainer.classList.remove('collapsed'); toggleButton.textContent='Hide Options ▲';} else{ optionsContainer.classList.add('collapsed'); toggleButton.textContent='Show Options ▼';}} function stopGame(){ if (!isGameActive) return; isGameActive=false; cancelAnimationFrame(animationId); ctx.clearRect(0, 0, canvas.width, canvas.height); document.getElementById('optionsContainer').classList.remove('collapsed'); document.getElementById('toggleOptions').style.display='none'; document.getElementById('gameArea').style.display='none';} document.getElementById('speedSlider').addEventListener('input', updateSpeed); document.addEventListener('keydown', function(event){ if (event.key >='1' && event.key <='3'){ checkAnswerByKey(event.key);}}); </script></body></html>